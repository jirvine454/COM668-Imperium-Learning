<ngx-spinner></ngx-spinner>

<link rel="stylesheet" href="https://cdn.tailgrids.com/tailgrids-fallback.css" />
<style>
  .gradient {
    margin-top: -24px;
    background: #B09A70;
  }
</style>

<div class="ml-24" *ngFor="let course of course_list | async">
  <h1><b id="h1">{{ course.course_title }}</b></h1>
</div>
<div class="w-full mb-4">
  <div class="h-1 mx-auto gradient w-64 opacity-25 my-0 py-0 rounded-t"></div>
</div>

<mat-tab-group>
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon style="margin-right: 5px;" class="example-tab-icon">description</mat-icon>
      Overview
    </ng-template>

    <!-- Course Cards Section Start -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-4 py-12">
      <div class="rounded-lg overflow-hidden mb-10" *ngFor="let course of course_list | async">
        <div class="flex-shrink-0">
          <img class="h-48 w-full object-cover" src="{{ course.course_image }}" alt="" />
        </div>
        <div class="flex flex-1 flex-col justify-between bg-slate-200">
          <div class="mt-2 block">
            <p class="text-xl font-semibold text-gray-900">
              {{ course.course_title }}
            </p>
            <div class="flex-1">
              <p class="text-sm font-medium text-indigo-600">
                <span>{{ course.course_difficulty }}</span>
              </p>
              <p class="mt-3 text-base text-gray-500">
                {{ course.course_description }}
              </p>
              <p class="mt-3 text-base text-gray-500">
                This course is of <b>{{course.course_category}}</b> category and currently has
                <b>{{course.num_of_students}}</b> students
                enrolled.
              </p>
              <p class="mt-3 text-base text-gray-500">
                Rating: {{ course.course_rating }} <mat-icon id="star">stars</mat-icon>
              </p>
            </div>
          </div>
          <div class="mt-6 flex items-center">
            <div class="flex-shrink-0">
              <span class="sr-only">test</span>
              <img class="h-10 w-10 rounded-full ml-3" src="{{ course.lecturer_image }}" alt="" />
            </div>
            <div class="ml-3">
              <p class="text-sm font-medium text-gray-900 ml-1">
                <span>{{ course.lecturer_name }}</span>
              </p>
              <div class="flex space-x-1 text-sm text-gray-500 ml-1 mb-2">
                <time>{{ course.display_date }}</time>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container-fluid">
        <p>Like what you see?</p><a href="mailto:">Click here to share via this course via email!</a>
      </div>
    </section>

    <!-- Edit Course Details -->
    <ng-container *ngIf="authService.isAuthenticated$ | async;">
      <h1>Edit Course Details</h1>
      <div class="container">
        <div class="row">
          <div class="col-sm-12">
            <h2>Please Enter the Courses Details</h2>
            <form [formGroup]="courseForm2">
              <div class="form-group">
                <label for="course_title">Title</label>
                <input type="text" id="course_title" name="course_title" class="form-control"
                  formControlName="course_title">
              </div>
              <div class="form-group">
                <label for="course_category">Category</label>
                <input type="text" id="course_category" name="course_category" class="form-control"
                  formControlName="course_category">
              </div>
              <div class="form-group">
                <label for="course_image">Image</label>
                <input type="text" id="course_image" name="course_image" class="form-control"
                  formControlName="course_image">
              </div>
              <div class="form-group">
                <label for="course_description">Description</label>
                <input type="text" id="course_description" name="course_description" class="form-control"
                  formControlName="course_description">
              </div>
              <div class="form-group">
                <label for="course_difficulty">Difficulty</label>
                <input type="text" id="course_difficulty" name="course_difficulty" class="form-control"
                  formControlName="course_difficulty">
              </div>
              <div class="form-group">
                <label for="lecturer_name">Lecturer Name</label>
                <input type="text" id="lecturer_name" name="lecturer_name" class="form-control"
                  formControlName="lecturer_name">
              </div>
              <div class="form-group">
                <label for="release_year">Release Year</label>
                <input type="text" id="release_year" name="release_year" class="form-control"
                  formControlName="release_year">
              </div>
              <span *ngIf="isIncomplete()">You must complete all fields</span>
              <button *ngIf="!isIncomplete()" type="submit" class="btn btn-primary">Submit</button>
            </form>
            <ng-template #loggedOut>
              <h2>Would you like to add a course? Please login to do so</h2>
            </ng-template>
          </div>
        </div>
      </div>
      <div *ngFor="let course of course_list | async" class="col-sm-6">
        <button class="btn btn-primary" id="btn" (click)="saveCourse(course)">Save Course</button>
      </div>
    </ng-container>
  </mat-tab>



  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon style="margin-right: 5px;" class="example-tab-icon">ondemand_video</mat-icon>
      Learning Materials
    </ng-template>
    <!-- Course Videos -->
    <div class="container" *ngFor="let course of course_list | async">
      <video width="400" controls>
        <source src="{{ course.lecture_video_one }}" type="video/mp4">
      </video>
      <video width="400" controls>
        <source src="{{ course.lecture_video_two }}" type="video/mp4">
      </video>
      <video width="400" controls>
        <source src="{{ course.lecture_video_three }}" type="video/mp4">
      </video>
    </div>
  </mat-tab>



  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon style="margin-right: 5px;" class="example-tab-icon">rate_review</mat-icon>
      Reviews
    </ng-template>

    <div *ngFor="let course of course_list | async">
      <h1>There are <b>{{course.review_count}}</b> Reviews Available for this Course.</h1>
    </div>
    <!-- Course Reviews -->
    <div class="container" *ngFor="let course of course_list | async">
      <mat-card class="mat-card-review" *ngFor="let review of reviews | async">
        <mat-card-header>
          <mat-card-title id="title">{{ review.name }}</mat-card-title>
          <mat-card-subtitle id="subtitle">{{ review.date.substr(0,10) | date }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>
            {{ review.text }}
          </p>
          <p>
            <i>{{ review.stars }} Stars</i>
          </p>
          <p>
            <b>Is this Review Helpful?</b>
            Like: {{ review.like }} Dislike: {{ review.dislike }}
          </p>
          <mat-icon class="green-icon" (click)="onUpdateLike(review)" *ngIf="!hide">thumb_up_alt</mat-icon>
          <mat-icon class="red-icon" (click)="onUpdateDislike(review)" *ngIf="!hide">thumb_down_alt</mat-icon>
          <hr>
          <h4 id="h4">Review Options:</h4>
          <mat-icon class="red-icon" (click)="onDeleteReview(review._id, course)">delete</mat-icon>
          <mat-icon class="blue-icon" (click)="onEditReview(review)">edit</mat-icon>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Create a Course Review -->
    <h1 class="ml-1">Create a Course Review</h1>
    <div class="container mb-20">
      <div class="row">
        <div class="col-sm-12">
          <form [formGroup]="reviewForm" (ngSubmit)="onSubmit(course)" *ngFor="let course of course_list | async">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" id="name" name="name" class="form-control" formControlName="name"
                [ngClass]="{ 'error': isInvalid('name') }">
            </div>
            <div class="form-group">
              <label for="review">Please leave your review below
              </label>
              <textarea id="review" rows="3" name="review" class="form-control" formControlName="review"
                [ngClass]="{ 'error': isInvalid('review') }"></textarea>
            </div>
            <div class="form-group">
              <label for="stars">Please provide a rating
                (5 = best)</label>
              <select id="stars" name="stars" class="form-control" formControlName="stars">
                <option value="1">1 star</option>
                <option value="2">2 stars</option>
                <option value="3">3 stars</option>
                <option value="4">4 stars</option>
                <option value="5">5 stars</option>
              </select>
            </div>

            <span *ngIf="isIncomplete()">You must complete all fields</span>
            <button *ngIf="!isIncomplete()" type="submit" id="btn" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>
    </div>

    <button *ngIf="!hideButton" class="btn btn-primary" id="btn" (click)="saveReview()">Save Review</button>
  </mat-tab>



  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon style="margin-right: 5px;" class="example-tab-icon">forum</mat-icon>
      Student Discussion
    </ng-template>

    <!-- Coure Discussion Chat Feed -->
    <div class="relative px-4 pt-16 pb-20 sm:px-6 lg:px-8 lg:pt-24 lg:pb-28 h-full">
      <div class="relative mx-auto max-w-7xl">
        <!-- Course Chat -->
        <div class="grid grid-cols-1 gap-4 lg:col-span-2 h-full">
          <section>
            <div class="overflow-hidden rounded-lg bg-white shadow h-full">
              <div class="p-6 h-full flex justify-center">
                <!-- <stream-channel-list></stream-channel-list> -->
                <stream-channel class="flex-grow" *ngIf="!loading && joinedChat">
                  <stream-channel-header></stream-channel-header>
                  <stream-message-list></stream-message-list>
                  <stream-notification-list></stream-notification-list>
                  <stream-message-input></stream-message-input>
                  <stream-thread name="thread">
                    <stream-message-list mode="thread"></stream-message-list>
                    <stream-message-input mode="thread"></stream-message-input>
                  </stream-thread>
                </stream-channel>

                <div *ngIf="loading && !joinedChat">Loading chat...</div>
                <div *ngIf="!loading && !joinedChat" class="flex flex-col gap-4 justify-center items-center">
                  <span class="text-xl">You are not yet a member of this chat.</span>
                  <button type="button" (click)="joinClassChat()"
                    class="inline-flex items-center rounded-md border border-transparent bg-imperium-gold px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-imperium-gold-hover focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Join chat
                  </button>
                </div>
              </div>
            </div>
          </section>
          <h1 class="text-3xl font-bold tracking-tight text-gray-900">
            <button type="button" *ngIf="joinedChat && !loading" (click)="leaveClassChat()"
              class="inline-flex mx-4 items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
              Leave chat
            </button>
          </h1>
        </div>
      </div>
    </div>

  </mat-tab>
</mat-tab-group>